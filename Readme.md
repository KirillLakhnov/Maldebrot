# Оптимизация фрактала Мандельброта

![Example 1](readme_files/maldebrot_picture.png)

## О ПРОЕКТЕ
В этом проекте я занимался оптимизацией алгоритма расчета множества Мандельброта, используя доступные на моем компьютере SIMD-инструкции такие, как SSE2, AVX2, AVX512, и флаги оптимизации компилятора, такие как -O1, -O2, -O3, -Ofast.

## Множество Мандельброта и алгоритм его расчета

**Множество Мандельброта** - это множество точек на плоскости таких, что для рекурсивных уравнений $x_{i+1} = x_i^2 - y_i^2 + x_0$ и $y_{i+1} = 2 * x_i * y_i+ y_0$ выполняется неравенство $R = (x^2 + y^2)^{1/2} >= R_{max}$, то есть функция $f(x_0, y_0) -> N$ ставит $(x_0, y_0)$ в соответствие число N - количество операций для нахождения таких x и y, что выполняется неравенство выше. Это множество является фрактальным.

### Код неоптимизированного алгоритма
```С++
for (int dy = 0; dy < 720; dy++)
{
    float y0 = (dy - cy)*scale;
    float x0 = (   - cx)*scale;

    for (int dx = 0; dx < 1280; dx++, x0 += scale)
    {
        int N = 0;

        float x = x0;
        float y = y0;

        while (N < NMax)
        {
            float x2 = x*x;
            float y2 = y*y;
            float xy = x*y;

            float r = x2 + y2;

            if (r > (RMAX)) 
            {
                break;
            }

            x = x2 - y2 + x0;
            y = 2*xy + y0;

            N++;
        }

        set_pixel (pixels, dx, dy, N); // Вычисляет цвет пикселя
    }
}
```
...

Как мы видим, производительность алгоритма зависит от количества пикселей в результирующем изображении. Алгоритм необходимо оптимизировать, так как в данном случае время расчетов пропорционально количеству рабочих пикселей.

Этот алгоритм часто используется для оценки вычислительной скорости аппаратного обеспечения.

Примечание: SFML используется в качестве графической библиотеки.

## Принципы оптимизации

Идеи оптимизаций, использующих инструкции SSE2, AVX2, AVX512, одинаковы.

В случае использования инструкций SSE2 и переменных типа _m128 мы можем одновременно обрабатывать по 4 пикселя, или же по 8 пикселей, используя инструкции AVX2 и переменные типа _m256. Также мы можем обрабатывать и по 16 пикселей одновременно с помощью инструкций AVX512 и переменных типа _m512.

## Результаты оптимизаций

В таблице ниже приведены значения FPS, измеренные для различных режимов оптимизации:

|Оптимизаиция \ Флаг|НЕТ |-O0 |-O1 |-O2 |-O3 |-Ofast |
|:------------------|:--:|:--:|:--:|:--:|:--:|:-----:|
|БЕЗ оптимизаций    |1.2 |1.2 |1.9 |2.1 |2.1 |2.2    |
|                   |    |    |    |    |    |       |
|Массивы пикселей   |0.3 |0.2 |1.1 |7.4 |7.4 |7.7    |
|                   |    |    |    |    |    |       |
|SSE инструкции     |1.9 |1.9 |4.5 |6.0 |6.0 |6.2    |
|                   |    |    |    |    |    |       |
|AVX2 инструкции    |2.9 |2.9 |5.5 |9.0 |9.0 |9.1    |
|                   |    |    |    |    |    |       |
|AVX512 инструкции  |4.0 |4.0 |6.4 |11.8|11.9|12.1   |

## Вывод
Оптимизация алгоритма рисования множества Мандельброта с использованием инстукций AVX512 позволяет его ускорить в **12.1/2.2 = 5.5** раз
